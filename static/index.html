<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv='X-UA-Compatible' content='IE=edge' />
    <meta name="abuseipdb-verification" content="DmbG28jg" />

    <link rel="icon" type="image/png" href="favicon.png">
    <link rel='stylesheet' href='style/main.css' />
    <link rel='stylesheet' href='style/dark-mode.css' />
    <link rel='stylesheet' href='chess/css/chessboard-1.0.0.min.css' />
    <link href="font-awesome/css/all.css" rel="stylesheet">

    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ギコっぽいぽい</title>
    <script>
        window.EXPECTED_SERVER_VERSION = Number.parseInt("@EXPECTED_SERVER_VERSION@");
    </script>
</head>

<body>
    <div id="vue-app" v-cloak v-bind:class="{'dark-mode': isDarkMode}">
        <div id="login-page" v-if="!loggedIn && !loggedOut && !isPoop">
            <header>
                <div>
                    <h1><a href="/">{{ $t("ui.title") }}</a></h1>
                    <h2>{{ $t("ui.subtitle") }}</h2>
                </div>
            </header>
            <form id="login-form">

                <input v-if="passwordInputVisible" type="text" v-model="password"></input>
                <div id="area-selection">
                    <label for="gen-selection"><input type="radio" id="gen-selection" value="gen" v-model="areaId"
                            v-on:click="setLanguage('ja')" :disabled="isLoggingIn">
                        一般 (_gen) [{{ $t("ui.login_user_count") }}@USER_COUNT_GEN@
                        {{ $t("ui.login_streamer_count") }}@STREAMER_COUNT_GEN@]</label>
                    <label for="for-selection"><input type="radio" id="for-selection" value="for" v-model="areaId"
                            v-on:click="setLanguage('en')" :disabled="isLoggingIn">
                        International (_for) [{{ $t("ui.login_user_count") }}@USER_COUNT_FOR@
                        {{ $t("ui.login_streamer_count") }}@STREAMER_COUNT_FOR@]</label>
                </div>
                <div>
                    <label>{{ $t("ui.label_username") }}</label>
                    <input id="username-textbox" type="text" v-model="username" maxlength="20" :disabled="isLoggingIn" />
                </div>
                <div id="character-selection">
                    <label v-for="character in allCharacters" :for="character.characterName + '-selection'"
                        v-show="!character.isHidden">
                        <template v-if="character.isHidden">
                            This is a secret, please don't tell anyone. これは秘密です、誰にも言わないでください。
                        </template>
                        <input type="radio" :id="character.characterName + '-selection'" :disabled="isLoggingIn"
                            :value="character.characterName" v-model="characterId">
                        <img :src="'characters/' + character.characterName + '/front-standing.' + character.format"
                            v-bind:class="{'character-selected': character.characterName == characterId}"/>
                    </label>
                </div>
                <button id="login-button" v-on:click="login" :disabled="isLoggingIn">Login</button>
            </form>
            <div id="login-footer" translate="no" class="notranslate">
                @LOGIN_FOOTER@
            </div>
        </div>
        <div id="stage" v-if="loggedIn && !isPoop">
            <h2 class="big-red-alert" v-if="connectionLost && !connectionRefused">
                {{ $t("msg.connection_lost") }}
            </h2>
            <h2 class="big-red-alert" v-if="pageRefreshRequired">
                {{ $t("msg.page_refresh_required") }}
            </h2>
            <h2 v-if="connectionRefused">
                {{ $t("msg.connection_refused") }}
            </h2>
            <div id="canvas-container" v-if="!connectionRefused">
                <canvas id="room-canvas" tabindex="1" v-on:keydown="handleCanvasKeydown($event)"
                    v-on:mousedown="handleCanvasPointerDown($event)"
                    v-on:mousemove="handleCanvasPointerMove($event)"
                    v-on:touchstart="handleCanvasPointerDown($event)"
                    v-on:touchmove="handleCanvasPointerMove($event)"
                    v-on:wheel="handleCanvasWheel($event)"
                    ></canvas>
                <div id="infobox-container">
                    <div id="infobox" v-show="isInfoboxVisible">
                        <div id="infobox-area" class="infobox-line">
                            <div class="infobox-title">{{ $t("ui.infobox_label_area") }}</div>
                            <div class="infobox-value">{{ $t("ui.infobox_value_area") }}</div>
                        </div>
                        <div id="infobox-roomname" class="infobox-line">
                            <div class="infobox-title">{{ $t("ui.infobox_label_room") }}</div>
                            <div class="infobox-value">{{ currentRoom.id && $t("room."+currentRoom.id) }}</div>
                        </div>
                        <div id="infobox-username" class="infobox-line">
                            <div class="infobox-title">{{ $t("ui.infobox_label_user_name") }}</div>
                            <div class="infobox-value">{{ myUserID && users && users[myUserID] ? toDisplayName(users[myUserID].name) :
                                '-' }}</div>
                        </div>
                        <div id="infobox-usercount" class="infobox-line">
                            <div class="infobox-title">{{ $t("ui.infobox_label_user_count") }}</div>
                            <div class="infobox-value">{{ serverStats.userCount }}</div>
                        </div>
                        <div id="infobox-streamcount" class="infobox-line">
                            <div class="infobox-title">{{ $t("ui.infobox_label_stream_count") }}</div>
                            <div class="infobox-value">{{ serverStats.streamCount }}</div>
                        </div>
                    </div>
                    <button id="infobox-button" class="canvas-button-top-right" v-on:click="toggleInfobox"
                        tabindex="-1"></button>
                </div>
            </div>
            <div id="toolbar">
                <div id="toolbar-text-input">
                    {{ $t("ui.label_input") }} <textarea id="input-textbox"
                        v-on:keypress="handleMessageInputKeypress($event)"
                        v-on:keydown="handleMessageInputKeydown($event)"
                        tabindex="2"
                        maxlength="500"></textarea>
                    <button id="send-button" v-on:click="sendMessageToServer" tabindex="3">{{ $t("ui.button_send") }}</button>
                </div>
                <div id="toolbar-buttons">
                    <div class="tooltip-section tooltip-volume-section">
                        <label>{{ $t("ui.sound_effect") }}</label>
                        <div id="sound-effect-volume"></div>
                    </div>
                    <div class="tooltip-section tooltip-volume-section" v-show="enableTextToSpeech">
                        <label>{{ $t("ui.tts_volume") }}</label>
                        <div id="voice-volume"></div>
                    </div>
                    <div class="tooltip-section" v-if="isCommandSectionVisible">
                        <button id="btn-rula" v-on:click="requestRoomList()">{{ $t("ui.button_rula") }}</button>
                        <button id="btn-list" v-on:click="openUserListPopup()">{{ $t("ui.button_list") }}</button>
                    </div>
                    <div class="tooltip-section">
                        <button v-on:click="openPreferencesPopup"
                                v-bind:title="$t('ui.button_preferences')"
                                class="fas fa-cogs"></button>
                        <button v-if="notificationPermissionsGranted"
                                v-on:click="toggleDesktopNotifications"
                                v-bind:title="$t('ui.preferences_show_notifications')"
                                class="fas"
                                v-bind:class="{'fa-bell': showNotifications, 'fa-bell-slash': !showNotifications}"></button>
                    </div>
                    <div class="tooltip-section" v-if="isMoveSectionVisible">
                        <div class='tooltip-section-title'>
                            <div>{{ $t("ui.label_move") }}</div>
                        </div>
                        <div class="non-wrappable-buttons">
                            <button id="btn-move-left" class="grid-button"
                                    v-on:mousedown="setMovementDirection('left')"
                                    v-on:mouseup="setMovementDirection(null)"
                                    v-on:touchstart="setMovementDirection('left')"
                                    v-on:touchend="setMovementDirection(null)">↖</button
                            ><button id="btn-move-up" class="grid-button"
                                    v-on:mousedown="setMovementDirection('up')"
                                    v-on:mouseup="setMovementDirection(null)"
                                    v-on:touchstart="setMovementDirection('up')"
                                    v-on:touchend="setMovementDirection(null)">↗</button>
                        </div>
                        <div class="non-wrappable-buttons">
                            <button id="btn-move-down" class="grid-button"
                                    v-on:mousedown="setMovementDirection('down')"
                                    v-on:mouseup="setMovementDirection(null)"
                                    v-on:touchstart="setMovementDirection('down')"
                                    v-on:touchend="setMovementDirection(null)">↙</button
                            ><button id="btn-move-right" class="grid-button"
                                    v-on:mousedown="setMovementDirection('right')"
                                    v-on:mouseup="setMovementDirection(null)"
                                    v-on:touchstart="setMovementDirection('right')"
                                    v-on:touchend="setMovementDirection(null)">↘</button>
                        </div>
                    </div>
                    <div class="tooltip-section" v-if="isBubbleSectionVisible">
                        <div class='tooltip-section-title'>
                            <div>{{ $t("ui.label_bubble") }}</div>
                        </div>
                        <div class="non-wrappable-buttons">
                            <button class="grid-button" v-on:click="sendNewBubblePositionToServer('left')">↖</button
                            ><button class="grid-button" v-on:click="sendNewBubblePositionToServer('up')">↗</button>
                        </div>
                        <div class="non-wrappable-buttons">
                            <button class="grid-button" v-on:click="sendNewBubblePositionToServer('down')">↙</button
                            ><button class="grid-button" v-on:click="sendNewBubblePositionToServer('right')">↘</button>
                        </div>
                    </div>
                    <div class="tooltip-section">
                        <button id="logout-button" v-if="isLogoutButtonVisible" v-on:click="logout" class="fas fa-sign-out-alt" v-bind:title="$t('ui.button_logout')"></button>
                    </div>
                </div>
            </div>
            {{ $t("ui.label_log") }}
            <div id="chatLog" tabindex="-1" v-bind:class="{'underlined-usernames': underlinedUsernames, 'timestamps-in-copied-log': timestampsInCopiedLog}" v-on:keydown="handlechatLogKeydown($event)">
            </div>
            <div id="video-streams">
                <div v-for="(streamSlot, index) in streams" v-bind:class="{'stream-is-active': streamSlot.isActive}">
                    <hr v-if="index != 0" />
                    <div>
                        {{ $t("ui.label_stream", {index: index+1}) }}<span class="stream-title">{{ streamSlot.title
                            }}</span>
                    </div>
                    <div :id="'video-container-' + index" class='video-container pinned-video' v-show="streamSlot.withVideo && ((takenStreams[index] && streamSlot.isReady) || index == streamSlotIdInWhichIWantToStream)">
                        <button
                            class="fas fa-thumbtack pin-video-button"
                            v-show="takenStreams[index] || (streamSlot.isActive && index == streamSlotIdInWhichIWantToStream)"
                            v-on:click="toggleVideoSlotPinStatus(index)"></button>
                        <video :id="'local-video-' + index"
                            v-show="streamSlot.isActive && index == streamSlotIdInWhichIWantToStream"
                            autoplay muted></video>
                        <video :id="'received-video-' + index"
                            v-show="takenStreams[index] && index != streamSlotIdInWhichIWantToStream"
                            autoplay></video>
                    </div>
                    <div :id="'vu-meter-container-' + index"
                        v-show="streamSlot.isActive && streamSlot.withSound && index == streamSlotIdInWhichIWantToStream">
                        <div :id="'vu-meter-bar-primary-' + index"></div>
                        <div :id="'vu-meter-bar-secondary-' + index"></div>
                    </div>
                    <div
                        v-show="takenStreams[index] && streamSlot.isReady && streamSlot.withSound && index != streamSlotIdInWhichIWantToStream">
                        <label for="stream-volume">{{ $t("ui.volume") }}</label>
                        <input type="range" :id="'volume-' + index" v-on:change="changeStreamVolume(index)"
                            name="stream-volume" min="0" max="1" step="0.01" :value="slotVolume[index]">
                        <div v-if="canUseAudioContext">
                            <label :for="'enable-compression-' + index">{{ $t("ui.enable_compression") }}</label>
                            <input type="checkbox"
                                :id="'enable-compression-' + index"
                                v-model="slotCompression[index]"
                                v-on:change="onCompressionChanged(index)">
                        </div>
                    </div>
                    <div class="stream-buttons">
                        <button :id="'take-stream-button-' + index"
                            v-bind:class="{'red-button': streamSlot.isReady}"
                            v-if="!takenStreams[index] && streamSlot.userId != myUserID && !wantToStream"
                            v-on:click="wantToTakeStream(index)">
                            {{ $t("ui.button_stream_take") }}
                        </button>
                        <button :id="'drop-stream-button-' + index"
                            v-if="takenStreams[index] && streamSlot.userId != myUserID && !wantToStream"
                            v-on:click="wantToDropStream(index)">
                            {{ $t("ui.button_stream_drop") }}
                        </button>

                        <button :id="'start-video-streaming-button-' + index"
                            v-if="!streamSlot.isActive && !wantToStream && streamSlotIdInWhichIWantToStream == null"
                            v-on:click="openStreamPopup(index)">
                            {{ $t("ui.button_stream_start") }}
                        </button>
                        <button :id="'stop-streaming-button-' + index"
                            v-if="streamSlotIdInWhichIWantToStream == index" v-on:click="stopStreaming">
                            {{ $t("ui.button_stream_stop") }}
                        </button>
                    </div>
                </div>
                <hr v-if="streams.length" />
                <chessboard-slot
                    v-if="currentRoom.hasChessboard"
                    v-bind:socket="socket"
                    v-bind:chessboard-state="chessboardState"
                    v-bind:users="users"
                    ></chessboard-slot>
            </div>

            <div class="popup-overlay" v-if="isRulaPopupOpen" v-on:click="closeRulaPopup"></div>
            <div id="rula-popup" class="popup" v-if="isRulaPopupOpen" v-on:keydown="handleRulaPopupKeydown($event)" tabindex="-1">
                <div class="popup-title">{{ $t("ui.rula_menu_title") }}</div>
                <div class="popup-content">
                    <table class="popup-table popup-selectable-table popup-sortable-table">
                        <colgroup>
                            <col id="rula-menu-column-room-name" />
                            <col id="rula-menu-column-user-count" />
                            <col id="rula-menu-column-streamers" />
                        </colgroup>
                        <thead>
                            <tr>
                                <th v-on:click="sortRoomList('sortName')">
                                    {{ $t("ui.rula_menu_column_room_name") }}
                                </th>
                                <th v-on:click="sortRoomList('userCount')">
                                    {{ $t("ui.rula_menu_column_user_count") }}
                                </th>
                                <th v-on:click="sortRoomList('streamerCount')">
                                    {{ $t("ui.rula_menu_column_streamers") }}
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="room in roomList"
                                :id="'room-tr-' + room.id"
                                v-bind:class="{'popup-row-is-selected': rulaRoomSelection == room.id}"
                                v-on:click="selectRoomForRula(room.id)">
                                <td>{{ $t("room." + room.id) }}</td>
                                <td>{{ room.userCount }}</td>
                                <td>{{ room.streamerDisplayNames.join(", ") }}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="popup-buttons">
                    <button v-on:click="rula(rulaRoomSelection)">{{ $t("ui.rula_menu_button_rula") }}</button><button
                        v-on:click="closeRulaPopup">{{ $t("ui.popup_button_cancel") }}</button>
                </div>
            </div>

            <div class="popup-overlay" v-if="isUserListPopupOpen" v-on:click="closeUserListPopup"></div>
            <div id="user-list-popup" class="popup" v-if="isUserListPopupOpen">
                <div class="popup-title">{{ $t("ui.user_list_popup_title") }}</div>
                <div class="popup-item" v-html="$t('ui.user_list_popup_blurb')"></div>
                <div class="popup-content">
                    <table class="popup-table">
                        <colgroup>
                            <col id="user-list-column-user-name" />
                            <col id="user-list-column-ignore-button" />
                        </colgroup>
                        <thead>
                            <tr>
                                <th>{{ $t("ui.user_list_popup_column_user_name") }}</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr :id="'user-list-element-' + u.id"
                                v-for="u in getUserListForListPopup()"
                                v-bind:class="{'popup-row-is-selected': u.id == highlightedUserId}">
                                <td>
                                    <div v-on:click="u.isInRoom && highlightUser(u.id, u.name)">
                                        <span v-bind:title="$t('ui.user_not_in_room')"
                                              class="user-not-in-room-warning fas fa-exclamation-triangle"
                                              v-if="!u.isInRoom"></span>
                                        <img v-bind:title="$t('ui.user_inactive')"
                                             v-if="u.isInactive"
                                             class="inactive-user-icon"
                                             src="zzz-sleep-symbol.svg"
                                              ></img>
                                        {{ u.name || $t("default_user_name") }}
                                    </div>
                                    <button v-if="ignoredUserIds.has(u.id)" v-on:click="unignoreUser(u.id)">{{ $t("ui.user_list_popup_unignore") }}</button>
                                    <button v-if="!ignoredUserIds.has(u.id)" v-on:click="ignoreUser(u.id)">{{ $t("ui.user_list_popup_ignore") }}</button>
                                    <button v-on:click="blockUser(u.id)">{{ $t("ui.user_list_popup_block") }}</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="popup-buttons">
                    <button v-on:click="closeUserListPopup">{{ $t("ui.user_list_popup_close") }}</button>
                </div>
            </div>


            <div class="popup-overlay" v-if="isStreamPopupOpen" v-on:click="closeStreamPopup"></div>
            <div id="stream-popup" class="popup" v-if="isStreamPopupOpen">
                <div class="popup-title">{{ $t("ui.stream_form_title") }}</div>
                <div class="popup-content">
                    <div class='popup-item'>
                        <span>{{ $t("ui.stream_form_mode") }}</span><input type="radio"
                            id="stream-form-video-sound-mode" value="video_sound" v-model="streamMode"><label
                            for="stream-form-video-sound-mode">{{ $t("ui.stream_form_video_sound_mode") }}</label>

                        <input type="radio" id="stream-form-sound-only-mode" value="sound" v-model="streamMode"><label
                            for="stream-form-sound-only-mode">{{ $t("ui.stream_form_sound_only_mode") }}</label>

                        <input type="radio" id="stream-form-video-only-mode" value="video" v-model="streamMode"><label
                            for="stream-form-video-only-mode">{{ $t("ui.stream_form_video_only_mode") }}</label>
                    </div>
                    <div class='popup-item' v-if="streamMode != 'sound'">
                        <input type="checkbox" id="stream-form-screen-capture" v-model="streamScreenCapture"><label
                            for="stream-form-screen-capture">{{ $t("ui.stream_form_screen_capture") }}</label>
                    </div>
                    <div class='popup-item' v-if="streamMode != 'sound' && !streamScreenCapture">
                        <span>{{ $t("ui.stream_form_camera_facing") }}</span><input type="radio"
                            id="stream-form-camera-facing-user" value="user" v-model="streamCameraFacing"><label
                            for="stream-form-camera-facing-user">{{ $t("ui.stream_form_camera_facing_user") }}</label>

                        <input type="radio" id="stream-form-camera-facing-environment" value="environment" v-model="streamCameraFacing"><label
                            for="stream-form-camera-facing-environment">{{ $t("ui.stream_form_camera_facing_environment") }}</label>
                    </div>
                    <div v-if="streamMode != 'video'">
                        <div class='popup-item'>
                            <button v-if="!displayAdvancedStreamSettings"
                                v-on:click="displayAdvancedStreamSettings = true">{{ $t("ui.stream_form_show_advanced") }}</button>
                            <button v-if="displayAdvancedStreamSettings"
                                v-on:click="displayAdvancedStreamSettings = false">{{ $t("ui.stream_form_hide_advanced") }}</button>
                        </div>
                        <div v-if="displayAdvancedStreamSettings">
                            <div class='popup-item' v-if="streamMode != 'sound' && streamScreenCapture">
                                <div>
                                    <input type="checkbox" id="stream-form-screen-capture-audio" v-model="streamScreenCaptureAudio"><label
                                        for="stream-form-screen-capture-audio">{{ $t("ui.stream_form_screen_capture_audio") }}</label>
                                </div>
                                <div class='popup-notice'>{{ $t("ui.stream_form_screen_capture_audio_notice") }}</div>
                            </div>
                            <div class='popup-item' v-if="!streamScreenCapture || !streamScreenCaptureAudio">
                                <div>
                                    <input type="checkbox" id="stream-form-echo-cancellation"
                                        v-model="streamEchoCancellation"><label for="stream-form-echo-cancellation">{{
                                        $t("ui.stream_form_echo_cancellation") }}</label>
                                </div>
                                <div v-if="!streamScreenCapture || !streamScreenCaptureAudio">
                                    <input type="checkbox" id="stream-form-noise-suppression"
                                        v-model="streamNoiseSuppression"><label for="stream-form-noise-suppression">{{
                                        $t("ui.stream_form_noise_suppression") }}</label>
                                </div>
                                <div v-if="!streamScreenCapture || !streamScreenCaptureAudio">
                                    <input type="checkbox" id="stream-form-auto-gain" v-model="streamAutoGain"><label
                                        for="stream-form-auto-gain">{{ $t("ui.stream_form_auto_gain") }}</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="popup-buttons">
                    <button v-on:click="wantToStartStreaming">{{ $t("ui.stream_form_button_stream") }}</button><button
                        v-on:click="closeStreamPopup">{{ $t("ui.popup_button_cancel") }}</button>
                </div>
            </div>

            <div class="popup-overlay" v-if="isPreferencesPopupOpen" v-on:click="closePreferencesPopup"></div>
            <div class="popup" v-if="isPreferencesPopupOpen">
                <div class="popup-title">{{ $t("ui.preferences_title") }}</div>
                <div class="popup-content">
                    <div class='popup-section'>
                        <div class='popup-header'>{{ $t("ui.preferences_title_general") }}</div>
                        <div class='popup-item'>
                            <input type="checkbox" id="preferences-shift-enter"
                                v-model="isNewlineOnShiftEnter" v-on:change="storeSet('isNewlineOnShiftEnter')"><label
                                for="preferences-shift-enter">{{ $t("ui.preferences_shift_enter") }}</label>
                        </div>
                        <div class='popup-item'>
                            <input type="checkbox" id="preferences-underlined-usernames"
                                v-model="underlinedUsernames" v-on:change="storeSet('underlinedUsernames')"><label
                                for="preferences-underlined-usernames">{{ $t("ui.preferences_underlined_usernames") }}</label>
                        </div>
                        <div class='popup-item'>
                            <input type="checkbox" id="preferences-timestamps-in-copied-log"
                                v-model="timestampsInCopiedLog" v-on:change="storeSet('timestampsInCopiedLog')"><label
                                for="preferences-timestamps-in-copied-log">{{ $t("ui.preferences_timestamps_in_copied_log") }}</label>
                        </div>
                        <div class='popup-item'>
                            <input type="checkbox" id="preferences-dark-mode"
                                v-model="isDarkMode" v-on:change="handleDarkMode"><label
                                for="preferences-dark-mode">{{ $t("ui.preferences_dark_mode") }}</label>
                        </div>
                    </div>
                    <div class='popup-section'>
                        <div class='popup-header'>{{ $t("ui.preferences_title_notifications") }}</div>
                        <div class='popup-item'>
                            <div>
                                <input type="checkbox" id="preferences-show-notifications"
                                    v-model="showNotifications" v-on:change="handleShowNotifications"><label
                                    for="preferences-show-notifications">{{ $t("ui.preferences_show_notifications") }}</label>
                            </div>
                            <div v-if="!notificationPermissionsGranted" class="popup-notice">{{ $t("ui.notifications_are_denied") }}</div>
                        </div>
                        <div class='popup-item'>
                            <input type="checkbox" id="preferences-login-sound-enabled"
                                v-model="isLoginSoundEnabled" v-on:change="storeSet('isLoginSoundEnabled')"><label
                                for="preferences-login-sound-enabled">{{ $t("ui.preferences_login_sound_enabled") }}</label>
                        </div>
                        <div class='popup-item'>
                            <input type="checkbox" id="preferences-message-sound-enabled"
                                v-model="isMessageSoundEnabled" v-on:change="storeSet('isMessageSoundEnabled')"><label
                                for="preferences-message-sound-enabled">{{ $t("ui.preferences_message_sound_enabled") }}</label>
                        </div>
                        <div class='popup-item'>
                            <input type="checkbox" id="preferences-name-mention-sound-enabled"
                                v-model="isNameMentionSoundEnabled" v-on:change="handleNameMentionSoundEnabled"><label
                                for="preferences-name-mention-sound-enabled">{{ $t("ui.preferences_name_mention_sound_enabled") }}</label>
                        </div>
                        <div class='popup-item'>
                            <div>
                                <label for="preferences-custom-mention-sound-pattern">{{ $t("ui.preferences_custom_mention_sound_pattern") }}</label>
                                <input type="text" id="preferences-custom-mention-sound-pattern"
                                    v-model="customMentionSoundPattern" v-on:change="handleCustomMentionSoundPattern">
                            </div>
                            <div class='popup-notice'>{{ $t("ui.preferences_custom_mention_sound_notice") }}</div>
                        </div>
                    </div>
                    <div class='popup-section'>
                        <div class='popup-header'>{{ $t("ui.preferences_title_game") }}</div>
                        <div class='popup-item'>
                            <input type="checkbox" id="preferences-name-bg"
                                v-model="showUsernameBackground" v-on:click="toggleUsernameBackground"><label
                                for="preferences-name-bg">{{ $t("ui.preferences_name_bg") }}</label>
                        </div>
                        <div class='popup-item'>
                            <label for="preferences-bubble-opacity">{{ $t("ui.preferences_bubble_opacity") }}</label>
                            <input type="range" id="preferences-bubble-opacity"
                                min="50" max="100" v-model="bubbleOpacity" v-on:change="handleBubbleOpacity"><div
                                class='preferences-percentage'>{{ bubbleOpacity }}%</div>
                        </div>
                        <div class='popup-item'>
                            <input type="checkbox" id="preferences-low-quality"
                                v-model="isLowQualityEnabled" v-on:change="handleLowQualityEnabled"><label
                                for="preferences-low-quality">{{ $t("ui.preferences_low_quality") }}</label>
                        </div>
                        <div class='popup-item'>
                            <input type="checkbox" id="preferences-crisp-mode"
                                v-model="isCrispModeEnabled" v-on:change="handleCrispModeEnabled"><label
                                for="preferences-crisp-mode">{{ $t("ui.preferences_crisp_mode") }}</label>
                        </div>
                    </div>
                    <div class='popup-section'>
                        <div class='popup-header'>{{ $t("ui.preferences_title_toolbar") }}</div>
                        <div class='popup-item'>
                            <input type="checkbox" id="preferences-command-section-visible"
                                v-model="isCommandSectionVisible" v-on:change="storeSet('isCommandSectionVisible')"><label
                                for="preferences-command-section-visible">{{ $t("ui.preferences_command_section_visible") }}</label>
                        </div>
                        <div class='popup-item'>
                            <input type="checkbox" id="preferences-move-section-visible"
                                v-model="isMoveSectionVisible" v-on:change="storeSet('isMoveSectionVisible')"><label
                                for="preferences-move-section-visible">{{ $t("ui.preferences_move_section_visible") }}</label>
                        </div>
                        <div class='popup-item'>
                            <input type="checkbox" id="preferences-bubble-section-visible"
                                v-model="isBubbleSectionVisible" v-on:change="storeSet('isBubbleSectionVisible')"><label
                                for="preferences-bubble-section-visible">{{ $t("ui.preferences_bubble_section_visible") }}</label>
                        </div>
                        <div class='popup-item'>
                            <input type="checkbox" id="preferences-logout-button-visible"
                                v-model="isLogoutButtonVisible" v-on:change="storeSet('isLogoutButtonVisible')"><label
                                for="preferences-logout-button-visible">{{ $t("ui.preferences_logout_button_visible") }}</label>
                        </div>
                    </div>
                    <div class='popup-section'>
                        <div class='popup-header'>{{ $t("ui.preferences_title_tts") }}</div>
                        <div class='popup-item'>
                            <input type="checkbox" id="preferences-text-to-speech"
                                v-model="enableTextToSpeech" v-on:change="handleEnableTextToSpeech"><label
                                for="preferences-text-to-speech">{{ $t("ui.preferences_enable_text_to_speech") }}</label>
                        </div>
                        <div class='popup-item'>
                            <label for="preferences-tts-voice">{{ $t("ui.preferences_tts_voice") }}</label>
                            <select id="preferences-tts-voice" v-model="ttsVoiceURI" v-on:change="changeVoice">
                                <option value="automatic">{{ $t("ui.preferences_tts_voice_automatic") }}</option>
                                <option value="animalese">{{ $t("ui.preferences_tts_voice_animalese") }}</option>
                                <option v-for="voice in availableTTSVoices" :value="voice.voiceURI">{{ voice.name }}</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="popup-buttons">
                    <button v-on:click="closePreferencesPopup">{{ $t("ui.popup_button_ok") }}</button>
                </div>
            </div>

            <div class="popup" v-if="isWarningToastOpen">
                <div class="popup-title">{{ $t("ui.warning_toast_title") }}</div>
                <div class="popup-content">
                    <div class="popup-item">
                        {{ warningToastMessage }}
                    </div>
                </div>
                <div class="popup-buttons">
                    <button v-on:click="closeWarningToast">{{ $t("ui.popup_button_ok") }}</button>
                </div>
            </div>
        </div>
        <div id="logged-out-page" v-if="loggedOut" class="full-screen-page">
            {{ $t("msg.goodbye") }}
            <img src="characters/giko/front-standing.svg"/>
            <a href="/">{{ $t("ui.back_to_homepage") }}</a>
        </div>
        <div id="poop-page" v-if="isPoop" class="full-screen-page">
            💩
        </div>
    </div>

    <script type="text/x-template" id="chessboard-slot">
        <div class="chessboard-slot-wrapper">
            <div>{{ $t("ui.chess_slot_title") }}</div>
            <button v-on:click="wantToDisplayGame()"
                    v-if="!visible"
                    v-bind:class="{'red-button': chessboardState?.blackUserID || chessboardState?.whiteUserID}">
                {{ $t("ui.chess_display_game")}}
            </button>
            <button v-on:click="wantToHideGame()" v-if="visible">
                {{ $t("ui.chess_hide_game")}}
            </button>
            <button v-on:click="wantToJoinGame()" v-if="!amIPlaying() && !chessboardState?.blackUserID">
                {{ $t("ui.chess_join_game")}}
            </button>
            <button v-on:click="wantToQuitGame()" v-if="amIPlaying()">
                {{ $t("ui.chess_quit_game")}}
            </button>
            <div v-show="visible">
                <div>
                {{ $t(!chessboardState?.whiteUserID ? "ui.chess_waiting_for_white"
                    : !chessboardState?.blackUserID ? "ui.chess_waiting_for_black"
                    : "") }}
                </div>
                <span v-if="chessboardState?.whiteUserID" v-bind:class="{'next-move-chess-player': chessboardState?.turn == 'w'}">
                    {{ $t("ui.chess_white") }}{{ users[chessboardState?.whiteUserID]
                                                ? (users[chessboardState?.whiteUserID]?.name || $t("default_user_name"))
                                                : "N/A" }}
                </span>
                <span v-if="chessboardState?.blackUserID" v-bind:class="{'next-move-chess-player': chessboardState?.turn == 'b'}">
                    {{ $t("ui.chess_black") }}{{ users[chessboardState?.blackUserID]
                                                 ? (users[chessboardState?.blackUserID]?.name || $t("default_user_name"))
                                                 : "N/A" }} 
                </span>
                <div 
                    id="chessboard"
                    v-show="chessboardState?.whiteUserID && chessboardState?.blackUserID"
                    style="width: 300px"></div>
            </div>
        </div>
    </script>

    <audio id="message-sound" src="message.mp3"></audio>
    <audio id="mention-sound" src="mention.mp3"></audio>
    <audio id="login-sound" src="login.mp3"></audio>

    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
    <script src="https://unpkg.com/vue-i18n@8.22.4/dist/vue-i18n.js"></script>
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script src='scripts/jquery.ui.touch-punch.min.js'></script>
    <script src="/socket.io/socket.io.js"></script>
    <script src='scripts/webrtc-codec-support.min.js'></script>
    <script type="module" src='scripts/chessboard-slot.js'></script>
    <script type="module" src='scripts/main.js'></script>

    <script src="scripts/riffwave.js"></script>
    <script src="scripts/Blob.js"></script>
    <script src="scripts/animalese.js"></script>
    <script src="chess/js/chessboard-1.0.0.min.js"></script>

    <script type="module" src='scripts/polyfills.js'></script>
    <script type="module" src='scripts/main.js'></script>
</body>

</html>